<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sorpresa</title>
<style>
  body{margin:0;background:black;overflow:hidden;font-family:'Courier New',monospace;}

  /* Estrellas */
  #estrellasCanvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;}

  /* Pantalla inicio */
  #inicio{position:fixed;width:100%;height:100%;
    background:linear-gradient(to top,#000,#330033);
    display:flex;align-items:center;justify-content:center;
    flex-direction:column;z-index:10;color:white;}
  #inicio button{padding:20px 40px;font-size:1.5rem;
    background:#ff69b4;color:white;border:none;border-radius:15px;
    cursor:pointer;box-shadow:0 0 20px #ff69b4;margin-top:20px;}

  /* Contadores */
  #contador{position:absolute;top:10px;left:50%;transform:translateX(-50%);
    color:white;font-size:1.2rem;z-index:4;background:rgba(0,0,0,0.4);
    padding:8px 40px;border-radius:10px;text-align:center;min-width:280px;display:none;}
  #tiempoTotal{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);
    color:#ff69b4;font-size:1.1rem;z-index:11;background:rgba(0,0,0,0.4);
    padding:8px 15px;border-radius:10px;text-align:center;white-space:pre-line;display:none;}

  /* Pantalla principal */
  .overlay{position:absolute;top:0;left:0;width:100%;height:100%;
    z-index:2;display:none;flex-direction:column;align-items:center;justify-content:center;pointer-events:none;}
  .center-image{width:200px;height:auto;border-radius:10px;margin-bottom:20px;
    box-shadow:0 0 20px #ff69b4;}
  .center-message{color:#ff69b4;font-size:2rem;text-align:center;}
  .btn{margin-top:15px;padding:10px 20px;font-size:1rem;background:#ff69b4;
    color:white;border:none;border-radius:10px;cursor:pointer;
    box-shadow:0 0 10px #ff69b4;pointer-events:auto;}

  /* Pantallas secundarias */
  .screen{display:none;position:fixed;top:0;left:0;width:100%;height:100%;
    background:black;z-index:20;flex-direction:column;align-items:center;justify-content:center;text-align:center;}
  .screen h2{color:#ff69b4;font-size:2rem;margin-bottom:20px;}
  .screen button{padding:12px 25px;font-size:1.2rem;background:#ff69b4;
    color:white;border:none;border-radius:12px;cursor:pointer;
    box-shadow:0 0 15px #ff69b4;margin-top:20px;}

  /* Puzzle */
  #puzzleCanvas{border:2px solid #ff69b4;border-radius:10px;box-shadow:0 0 20px #ff69b4;}

  /* Confeti */
  #confetiCanvas{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:100;}
  #confetiMensaje{position:fixed;top:20%;left:50%;transform:translateX(-50%);
    color:#ff69b4;font-size:2rem;font-weight:bold;text-align:center;
    text-shadow:0 0 15px #fff;z-index:101;display:none;}

  /* Carta secreta */
  #cartaOverlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,0.85);z-index:200;align-items:center;justify-content:center;flex-direction:column;}
  #cartaTexto{background:#fff;padding:30px;border-radius:15px;
    max-width:80%;color:#333;font-size:1.3rem;text-align:center;box-shadow:0 0 20px #ff69b4;}
</style>
</head>
<body>

<!-- Estrellas -->
<canvas id="estrellasCanvas"></canvas>

<!-- Pantalla de inicio -->
<div id="inicio">
  <h1>üéÅ Tengo algo especial para ti</h1>
  <button onclick="iniciarSorpresa()">Haz clic para abrir</button>
</div>

<!-- Pantalla principal -->
<div id="contador"></div>
<div id="tiempoTotal"></div>
<div class="overlay" id="contenido">
  <img src="imagen.jpg" alt="Foto juntos" class="center-image" />
  <div class="center-message">TE AMO ‚ù§Ô∏è</div>
  <button id="btnRecuerdos" class="btn">üíå Nuestros recuerdos</button>
  <button id="btnFotos" class="btn">üì∑ Nuestras fotos</button>
  <button id="btnJuego" class="btn">üïπÔ∏è Mini-juego</button>
  <button id="btnFechas" class="btn">üéâ Fechas especiales</button>
</div>

<!-- Pantalla recuerdos -->
<div class="screen" id="recuerdosScreen">
  <h2>Nuestros Recuerdos</h2>
  <ul style="color:white;list-style:none;padding:0;">
    <li>15 de julio 2023 ‚Äì Nuestro reencuentro üíñ</li>
    <li>21 de julio 2023 ‚Äì Primera salida ‚ú®</li>
  </ul>
  <button class="btnVolver">‚¨ÖÔ∏è Regresar</button>
</div>

<!-- Pantalla fotos -->
<div class="screen" id="fotosScreen">
  <h2>Nuestras Fotos</h2>
  <canvas id="canvasFotos"></canvas>
  <button class="btnVolver">‚¨ÖÔ∏è Regresar</button>
</div>

<!-- Pantalla mini-juego -->
<div class="screen" id="juegoScreen">
  <h2>Rompecabezas</h2>
  <canvas id="puzzleCanvas" width="300" height="300"></canvas>
  <p style="color:white;">Haz clic en dos piezas para intercambiarlas</p>
  <button class="btnVolver">‚¨ÖÔ∏è Regresar</button>
</div>

<!-- Pantalla fechas especiales -->
<div class="screen" id="fechasScreen">
  <h2>Fechas Especiales</h2>
  <div id="cuentaRegresiva" style="color:white;font-size:1.3rem;margin-bottom:20px;"></div>
  <button id="btnCartaSecreta" style="display:none;">üíå Carta Secreta</button>
  <button class="btnVolver">‚¨ÖÔ∏è Regresar</button>
</div>

<!-- Carta secreta -->
<div id="cartaOverlay">
  <div id="cartaTexto">üíñ Mi amor, gracias por compartir esta fecha especial conmigo. Eres lo mejor que me ha pasado üíñ</div>
  <button onclick="document.getElementById('cartaOverlay').style.display='none'" style="margin-top:20px;">Cerrar</button>
</div>

<!-- Confeti -->
<canvas id="confetiCanvas"></canvas>
<div id="confetiMensaje"></div>

<audio id="musica" loop>
  <source src="musica.mp3" type="audio/mpeg">
</audio>
<canvas id="canvas"></canvas>

<script>
/* ===== INICIO ===== */
let lluviaPrincipalIniciada=false;
function iniciarSorpresa(){
  document.getElementById('inicio').style.display='none';
  document.getElementById('contenido').style.display='flex';
  document.getElementById('contador').style.display='block';
  document.getElementById('tiempoTotal').style.display='block';
  document.getElementById('musica').play();
  calcularDiasJuntos();
  iniciarTiempoTotal();
  if(!lluviaPrincipalIniciada){
    iniciarAnimacion();
    lluviaPrincipalIniciada=true;
  }
  checkFechasEspeciales();
}

/* ===== Estrellas ===== */
(function(){
  const canvas=document.getElementById('estrellasCanvas');
  const ctx=canvas.getContext('2d');
  function resize(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
  resize(); window.addEventListener('resize',resize);
  const stars=Array.from({length:120},()=>({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    r:Math.random()*1.5,
    o:Math.random()
  }));
  function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    stars.forEach(s=>{
      s.o+= (Math.random()-0.5)*0.05;
      if(s.o<0) s.o=0; if(s.o>1) s.o=1;
      ctx.beginPath();
      ctx.fillStyle=`rgba(255,255,255,${s.o})`;
      ctx.arc(s.x,s.y,s.r,0,2*Math.PI);
      ctx.fill();
    });
    requestAnimationFrame(animate);
  }
  animate();
})();

/* ===== Contadores ===== */
function calcularDiasJuntos(){
  const inicio=new Date("2023-08-11T20:00:00");
  const hoy=new Date();
  const diff=hoy-inicio;
  const dias=Math.floor(diff/(1000*60*60*24));
  document.getElementById("contador").innerText=`Llevamos ${dias} d√≠as juntosüíñ`;
}
function iniciarTiempoTotal(){
  const inicio=new Date("2023-08-11T20:00:00");
  function actualizar(){
    const ahora=new Date();
    let a√±os=ahora.getFullYear()-inicio.getFullYear();
    let meses=ahora.getMonth()-inicio.getMonth();
    let dias=ahora.getDate()-inicio.getDate();
    if(dias<0){meses--;dias+=new Date(ahora.getFullYear(),ahora.getMonth(),0).getDate();}
    if(meses<0){a√±os--;meses+=12;}
    const diffMs=ahora-inicio;
    const horas=Math.floor((diffMs/(1000*60*60))%24);
    const minutos=Math.floor((diffMs/(1000*60))%60);
    const segundos=Math.floor((diffMs/1000)%60);
    document.getElementById("tiempoTotal").innerText=
      `A√±os: ${a√±os} | Meses: ${meses} | D√≠as: ${dias}\nTiempo juntos: ${horas}h ${minutos}m ${segundos}s`;
  }
  actualizar(); setInterval(actualizar,1000);
}

/* ===== Pantallas ===== */
const pantallas=["recuerdosScreen","fotosScreen","juegoScreen","fechasScreen"];
function mostrarPantalla(id){
  document.getElementById('contenido').style.display='none';
  document.getElementById('contador').style.display='none';
  document.getElementById('tiempoTotal').style.display='none';
  pantallas.forEach(p=>document.getElementById(p).style.display='none');
  document.getElementById(id).style.display='flex';
}
function regresarPantalla(){
  pantallas.forEach(p=>document.getElementById(p).style.display='none');
  document.getElementById('contenido').style.display='flex';
  document.getElementById('contador').style.display='block';
  document.getElementById('tiempoTotal').style.display='block';
}

/* Botones navegaci√≥n */
document.querySelectorAll('.btnVolver').forEach(b=>b.addEventListener('click',regresarPantalla));
document.getElementById('btnRecuerdos').onclick=()=>mostrarPantalla('recuerdosScreen');
document.getElementById('btnFotos').onclick=()=>{mostrarPantalla('fotosScreen');iniciarLluviaFotos();};
document.getElementById('btnJuego').onclick=()=>{mostrarPantalla('juegoScreen');iniciarPuzzle();};
document.getElementById('btnFechas').onclick=()=>{mostrarPantalla('fechasScreen');iniciarCuentaRegresiva();};

/* ===== Fotos cayendo ===== */
function iniciarLluviaFotos(){
  const canvas=document.getElementById('canvasFotos');
  const ctx=canvas.getContext('2d');
  canvas.width=window.innerWidth;canvas.height=window.innerHeight;
  const fotos=[];
  for(let i=1;i<=30;i++){
    const img=new Image();
    img.src=`fotos/foto${i}.jpg`;
    fotos.push({img,x:Math.random()*canvas.width,y:Math.random()*canvas.height,speed:1+Math.random()*1.5,size:50+Math.random()*50});
  }
  function draw(){
    ctx.fillStyle="rgba(0,0,0,0.1)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    fotos.forEach(f=>{
      if(f.img.complete)ctx.drawImage(f.img,f.x,f.y,f.size,f.size);
      f.y+=f.speed;if(f.y>canvas.height){f.y=-f.size;f.x=Math.random()*canvas.width;}
    });
    requestAnimationFrame(draw);
  } draw();
}

/* ===== Puzzle ===== */
function iniciarPuzzle(){
  const canvas=document.getElementById('puzzleCanvas');
  const ctx=canvas.getContext('2d');
  const size=3; // 3x3
  const img=new Image();
  img.src="puzzle.jpg"; // tu imagen del rompecabezas
  const tiles=[];
  for(let y=0;y<size;y++)for(let x=0;x<size;x++)tiles.push({x,y});
  tiles.sort(()=>Math.random()-0.5);
  img.onload=draw;
  let first=null;
  canvas.onclick=function(e){
    const rect=canvas.getBoundingClientRect();
    const cx=Math.floor((e.clientX-rect.left)/(canvas.width/size));
    const cy=Math.floor((e.clientY-rect.top)/(canvas.height/size));
    const index=tiles.findIndex(t=>t.px===cx&&t.py===cy);
    if(index<0)return;
    if(!first){first=index;}
    else{
      [tiles[first],tiles[index]]=[tiles[index],tiles[first]];
      first=null; draw();
      if(tiles.every((t,i)=>t.x===Math.floor(i%size)&&t.y===Math.floor(i/size)))
        setTimeout(()=>alert("¬°Lo lograste amor! üíñ"),200);
    }
  };
  function draw(){
    const w=canvas.width/size,h=canvas.height/size;
    tiles.forEach((t,i)=>{
      const dx=(i%size)*w,dy=Math.floor(i/size)*h;
      t.px=i%size;t.py=Math.floor(i/size);
      ctx.drawImage(img,t.x*(img.width/size),t.y*(img.height/size),img.width/size,img.height/size,dx,dy,w,h);
    });
  }
}

/* ===== Fechas especiales ===== */
const fechas=[
  {mes:1,dia:10,texto:"üéÇ Tu cumplea√±os üéâ"},
  {mes:6,dia:8,texto:"üéÇ Cumplea√±os amor üíñ"},
  {mes:7,dia:11,texto:"üéâ Aniversario üíñ"},
  {mes:(new Date()).getMonth(),dia:25,texto:"‚ú® D√≠a de prueba"}
];
function proximaFecha(){
  const hoy=new Date();
  let mejor=null,mejorDiff=Infinity;
  fechas.forEach(f=>{
    let prox=new Date(hoy.getFullYear(),f.mes,f.dia);
    if(prox<hoy)prox.setFullYear(hoy.getFullYear()+1);
    const diff=prox-hoy;
    if(diff<mejorDiff){mejorDiff=diff;mejor=prox;}
  });
  return mejor;
}
function iniciarCuentaRegresiva(){
  const destino=proximaFecha();
  const div=document.getElementById('cuentaRegresiva');
  function tick(){
    const ahora=new Date();
    const diff=destino-ahora;
    const d=Math.floor(diff/(1000*60*60*24));
    const h=Math.floor((diff/(1000*60*60))%24);
    const m=Math.floor((diff/(1000*60))%60);
    const s=Math.floor((diff/1000)%60);
    div.textContent=`Pr√≥xima fecha especial en ${d}d ${h}h ${m}m ${s}s`;
  }
  tick(); setInterval(tick,1000);
}

/* ===== Carta secreta y confeti ===== */
function checkFechasEspeciales(){
  const hoy=new Date();
  const d=hoy.getDate();
  const m=hoy.getMonth();
  let mensaje=null;
  if(d===11){mensaje="Feliz otro mes m√°s juntos üíñ";}
  if(d===11 && m===7){mensaje="üéâ Feliz aniversario üíñ";}
  if(d===8 && m===6){mensaje="üéÇ Feliz cumplea√±os amor üíñ";}
  if(d===10 && m===1){mensaje="üéÇ Feliz cumplea√±os üéâ";}
  if(d===25){mensaje="‚ú® D√≠a de prueba üíñ";} // prueba
  if(mensaje){
    lanzarConfeti(mensaje);
    document.getElementById('btnCartaSecreta').style.display='inline-block';
    document.getElementById('btnCartaSecreta').onclick=()=>document.getElementById('cartaOverlay').style.display='flex';
  }
}
function lanzarConfeti(mensaje){
  const canvas=document.getElementById('confetiCanvas');
  const ctx=canvas.getContext('2d');
  const msg=document.getElementById('confetiMensaje');
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;
  msg.innerText=mensaje;
  msg.style.display='block';
  const confetis=[];
  for(let i=0;i<200;i++){
    confetis.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,
      r:5+Math.random()*10,dx:Math.random()*2-1,dy:Math.random()*3+2,
      color:`hsl(${Math.random()*360},100%,50%)`});
  }
  let start=Date.now();
  (function draw(){
    const elapsed=Date.now()-start;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    confetis.forEach(c=>{
      ctx.beginPath();
      ctx.arc(c.x,c.y,c.r,0,2*Math.PI);
      ctx.fillStyle=c.color;
      ctx.fill();
      c.x+=c.dx;c.y+=c.dy;
      if(c.y>canvas.height){c.y=-c.r;c.x=Math.random()*canvas.width;}
    });
    if(elapsed<5000)requestAnimationFrame(draw);
    else msg.style.display='none';
  })();
}

/* ===== Animaci√≥n principal (lluvia TE AMO) ===== */
function iniciarAnimacion(){
  const canvas=document.getElementById('canvas');
  const ctx=canvas.getContext('2d');
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;
  ctx.font="16px monospace";
  const drops=new Array(Math.floor(canvas.width/32)).fill(1);
  function drawRain(){
    ctx.fillStyle="rgba(0,0,0,0.1)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="#ff69b4";
    drops.forEach((drop,i)=>{
      const x=i*32;
      const y=drop*12;
      ctx.fillText("TE AMO",x,y);
      if(y>canvas.height && Math.random()>0.98) drops[i]=0;
      drops[i]+=0.7;
    });
    requestAnimationFrame(drawRain);
  }
  drawRain();
}
</script>
</body>
</html>
